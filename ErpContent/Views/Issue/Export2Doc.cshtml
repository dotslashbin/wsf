@using ErpContent.Views.Helpers;
 
@{
    Layout = null;
}

<!DOCTYPE html>

<style>
    html * {
        font-family: "Times New Roman";
    }

    p.notes-container {
    }
    p.notes-container-retired {
        line-height: 100%;
        text-indent: 4em;
        column-count: 2;
    }
</style>


<html>
<head>
    <meta name="viewport" content="width=device-width" charset="utf-8" />
    <title>Export2Doc</title>
</head>
<body>
    <div> 

        @foreach (var a in Model.assignments)
        {
            //
            // iterate thru all assignments, tasting records, notes for an issue 
            // 
            //
            <br />
            <br />
            Assignment:<div>@a.title</div>
            
            if( a.tastingEvents != null ){

                
                foreach (var t in a.tastingEvents)
                {
            
                    if (t.tastingNotes != null && t.tastingNotes.Count > 0)
                    {
                        <br />
                        foreach (var n in t.tastingNotes)
                        {
                            <div>
                                <b>@n.producer.ToUpper()
                                &#09;@n.vintage.ToUpper()
                                &#09;@n.wineName.ToUpper()
                                &#09;@t.NoteAppellation(n).ToUpper()
                                &#09;(@t.NotePrice(n))      
                                &#09;@n.color.ToUpper()
                                &#09;@n.encodeRatingForPrinting() 

                                </b>
                            </div>
                        }
                        <br />
                    }
                    
                    if (t.tastingNotes != null && t.tastingNotes.Count > 0)
                    {
                        int cnt = 0;
                        if(  !String.IsNullOrEmpty( t.comments )){
                            string notes = NotesHelper.applyFormatting(t.comments);

                            <div  style="text-indent: 4em;">@Html.Raw(notes)</div>                        
                        }


                        foreach (var n in t.tastingNotes)
                        {
                            /// 
                            /// 
                            /// 
                            cnt++;
                                    
                            var vintagePlusWineName = n.vintage.ToUpper() + ' ' + n.wineName;
                            var vintagePlusWineNameBold = "<b>" + vintagePlusWineName + "</b>";
                            string noteText = n.note;
                            string drinkDate = n.DrindDateToString();
                                    
                            if( !String.IsNullOrEmpty(drinkDate) ) {
                                noteText += " Anticipated maturity: " + drinkDate + ".";
                            }
                                    
                            //
                            // if vintage+label can be find within tasting note body, make it bold
                            // 
                            noteText = noteText.Replace(vintagePlusWineName, vintagePlusWineNameBold);

                                    
                            string output = NotesHelper.applyFormatting(noteText);
                            //
                            // add importers only to last tasting note withing that tasting record.
                            //
                            if (!String.IsNullOrEmpty(n.importers) && cnt == t.tastingNotes.Count)
                            {
                                output += " Importer(s): " + n.importers + ".";
                            }
                                    
                            <div style="text-indent: 4em;">@Html.Raw(output)</div>
                        }
                    }
                }
            }
            
        }
    </div>
</body>
</html>
